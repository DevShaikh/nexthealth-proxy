# Air Ledger Platform Backend

This is a Node.js backend project using TypeScript, Express, and Zod for validation. It is structured as a microservices-ready monolith, with an isolated, testable, and versioned calculation engine, and an event-driven data pipeline ready for real-time processing. SOC 2 security best practices are followed from day one.

## Features

-   Node.js + TypeScript
-   Express.js API server
-   **PostgreSQL Database Integration (via NeonDB)**
-   **Prisma ORM for database interactions**
-   **Modular Prisma schema for clear organization (e.g., `user.prisma`, `profile.prisma`, `building.prisma` managed by `schema.prisma`)**
-   Zod for input validation
-   Modular structure for future microservices
-   Isolated calculation engine (testable, versioned)
-   Event-driven data pipeline abstraction
-   SOC 2 security best practices (input validation, error handling, logging, secure headers)
-   **Completed "Building" flow (CRUD operations for buildings)**
-   **Authentication flows implemented**

## Getting Started

To get the development environment up and running:

1.  **Install dependencies:**
    ```bash
    npm install
    ```

2.  **Configure Environment Variables for NeonDB:**
    * Create a `.env` file in the root of your project.
    * **Get your PostgreSQL Connection String from your Neon project dashboard.**
    * Add your database connection string and any other necessary environment variables:
        ```env
        # .env
        DATABASE_URL="YOUR_NEON_POSTGRES_CONNECTION_STRING" # Example: postgresql://user:password@ep-noisy-hall-123456.us-east-2.aws.neon.tech/airledger?sslmode=require
        PORT=3000
        # ... other environment variables
        ```
    *Replace `YOUR_NEON_POSTGRES_CONNECTION_STRING` with your actual connection string from NeonDB.*

3.  **Apply Prisma Migrations:**
    * This will connect to your NeonDB PostgreSQL database (as configured in `.env`), apply all pending migrations, and generate the Prisma Client based on your schema.
    * Run this command whenever you make changes to your Prisma schema files:
        ```bash
        npx prisma migrate dev --name init # Use a descriptive name like 'init' for the first migration
        ```

4.  **Run the development server:**
    ```bash
    npm run dev
    ```
    The API should now be running, typically on `http://localhost:3000` (or your configured `PORT`).

## Project Structure

-   `src/` - Main source code
    -   `routes/` - **Express route definitions**
        -   `v1/` - **Version 1 routes (e.g., `routes/v1/authRoutes.ts`, `routes/v1/buildingRoutes.ts`)**
    -   `controllers/` - **Request handling logic, parsing requests, calling services**
        -   `v1/` - **Version 1 controllers (e.g., `controllers/v1/authController.ts`, `controllers/v1/buildingController.ts`)**
    -   `services/` - **Business logic and data manipulation, interacting with the database**
        -   `v1/` - **Version 1 services (e.g., `services/v1/authService.ts`, `services/v1/buildingService.ts`)**
    -   `models/` - Database models and Prisma Client instance (e.g., `models/prisma.ts` for `new PrismaClient()` instance, or custom interfaces/types not directly generated by Prisma)
    -   `calculation/` - Calculation engine (isolated, versioned)
    -   `pipeline/` - Event/data pipeline modules
    -   `security/` - Security, validation, error handling
    -   `schemas/` - Zod validation schemas (e.g., `buildingSchema.ts`)
    -   `server.ts` - **Express app entry point**
-   `prisma/` - **Prisma schema definition files (e.g., `schema.prisma` - the main entry; `user.prisma`, `profile.prisma`, `building.prisma`)**
-   `.env` - Environment variables

## Notes

-   Authentication methods (e.g., JWT, sessions) and specific security implementations are handled within the `auth` related files and `security` module.
